<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙˆØµÙ„ÙŠ - Wassaly</title>
<style>
:root{
    --primary:#607d8b;
    --card:#ffffffee;
    --text:#333;
    --background:#e0e0e0;
}
body.dark{
    --primary:#00bcd4;
    --card:#1e1e2fdd;
    --text:#e0e0ff;
    --background:#121226;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:var(--background);color:var(--text);transition: background 0.3s,color 0.3s;}
#splash{position:fixed;inset:0;background:var(--background);display:flex;align-items:center;justify-content:center;z-index:9999;animation:fadeOut 1s ease forwards;animation-delay:2.5s;}
#splash h1{background:var(--primary);color:#fff;padding:20px 40px;border-radius:20px;}
@keyframes fadeOut{to{opacity:0;visibility:hidden}}
header,footer{background:var(--card);padding:15px;text-align:center;border-radius:12px;margin:5px 10px;backdrop-filter:blur(8px);box-shadow:0 4px 10px #0002;transition: background 0.3s;}
nav{display:flex;gap:10px;justify-content:center;margin:15px 0;}
nav button{background:var(--primary);color:#fff;border:none;padding:10px 20px;border-radius:12px;cursor:pointer;transition: background 0.3s, transform 0.2s;}
nav button:hover{background:#455a64;transform:translateY(-2px);}
.page{display:none;padding:20px}
.page.active{display:block}
.box{max-width:700px;margin:auto;background:var(--card);padding:25px;border-radius:22px;box-shadow:0 8px 25px #0002;transition: background 0.3s;}
h2{text-align:center;color:var(--primary)}
input,select,textarea,button{width:100%;padding:12px;margin:6px 0;border-radius:12px;border:1px solid #ccc;transition:border 0.3s, background 0.3s;}
input:focus,select:focus,textarea:focus{border-color:var(--primary);outline:none;}
button{background:var(--primary);color:#fff;border:none;}
button:hover{background:#455a64;}
.order{border:1px dashed #ccc;padding:12px;border-radius:14px;margin:10px 0;background:#fff8;box-shadow:0 4px 12px #0001;}
.status-new{color:green;font-weight:bold}
.status-run{color:orange;font-weight:bold}
.status-done{color:blue;font-weight:bold}
#help{position:fixed;right:18px;bottom:20px;z-index:60}
#help button{background:#25D366;border-radius:12px;padding:10px 14px;cursor:pointer;}
#helpOptions{display:none;background:var(--card);border-radius:14px;overflow:hidden;margin-bottom:8px;box-shadow:0 6px 20px #0002;}
#helpOptions a{display:block;padding:10px 14px;text-decoration:none;color:var(--text);transition:background 0.2s;}
#helpOptions a:hover{background:#ccc3;}
.theme-toggle{position:fixed;top:15px;left:15px;width:60px;height:30px;background:var(--primary);border-radius:30px;cursor:pointer;display:flex;align-items:center;padding:2px;transition: background 0.3s;z-index:50;}
.toggle-circle{width:26px;height:26px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;transition: all 0.3s ease;font-size:16px;margin-left:2px;}
body.dark .toggle-circle{margin-left:calc(100% - 28px);}
</style>
</head>
<body>
<div id="splash"><h1>ÙˆØµÙ„ÙŠ - Wassaly</h1></div>

<div class="theme-toggle" onclick="toggleTheme()"><div class="toggle-circle">ğŸŒ</div></div>

<header><h1>ÙˆØµÙ„ÙŠ - Wassaly</h1><p>Ø®Ø¯Ù…Ø© ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹Ø© ÙˆØ¢Ù…Ù†Ø©</p></header>
<nav>
<button onclick="showPage('orderPage')">Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„</button>
<button onclick="showPage('driverPage')">Ø§Ù„Ø³ÙˆØ§Ù‚</button>
<button onclick="showPage('adminPage')">Admin</button>
</nav>

<section id="orderPage" class="page active">
<div class="box">
<h2>Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„</h2>
<input id="cname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
<input id="cphone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)">
<input id="clocation" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø±Ø§Ø¨Ø· Ø£Ùˆ Ù†Øµ)">
<textarea id="details" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨"></textarea>
<input id="price" type="number" min="10" placeholder="Ø§Ù„Ø³Ø¹Ø± (10 Ø¬Ù†ÙŠÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)">
<select id="typeClient">
    <option value="Ø¹Ù…ÙŠÙ„">Ø¹Ù…ÙŠÙ„</option>
    <option value="Ù…ØªØ¬Ø±">Ù…ØªØ¬Ø±</option>
    <option value="Ù…Ø·Ø¹Ù…">Ù…Ø·Ø¹Ù…</option>
    <option value="ÙˆØµÙ„Ù†ÙŠ">ÙˆØµÙ„Ù†ÙŠ</option>
</select>
<select id="selectDriver">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ§Ù‚</option>
</select>
<button onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>
</section>

<section id="driverPage" class="page">
<div class="box">
<h2>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³ÙˆØ§Ù‚</h2>
<input id="driverName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ§Ù‚ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
<input id="driverPhone" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ù‚ (11 Ø±Ù‚Ù…)">
<button onclick="enterDriver()">Ø¯Ø®ÙˆÙ„</button>
<h2>Ø·Ù„Ø¨Ø§ØªÙƒ</h2>
<div id="driverOrders"></div>
</div>
</section>

<section id="adminPage" class="page">
<div class="box">
<h2>Admin Login</h2>
<input id="adminPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="adminLogin()">Ø¯Ø®ÙˆÙ„</button>
<div id="adminPanel" style="display:none">
<h2>ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
<div id="allOrders"></div>
<h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ§Ù‚ÙŠÙ†</h2>
<div id="allDrivers"></div>
</div>
</div>
</section>

<div id="help">
<button onclick="toggleHelp()">ğŸ’¬ Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
<div id="helpOptions">
<a href="https://wa.me/201208624618?text=Ø´ÙƒÙˆÙ‰ ØªØ£Ø®ÙŠØ± Ø§Ù„Ø·Ù„Ø¨" target="_blank">â° ØªØ£Ø®ÙŠØ± Ø§Ù„Ø·Ù„Ø¨</a>
<a href="https://wa.me/201208624618?text=Ø´ÙƒÙˆÙ‰ Ø§Ù„Ø³ÙˆØ§Ù‚ Ù„Ù… ÙŠØªÙˆØ§ØµÙ„" target="_blank">ğŸ“ Ø§Ù„Ø³ÙˆØ§Ù‚ Ù„Ù… ÙŠØªÙˆØ§ØµÙ„</a>
<a href="https://wa.me/201208624618?text=Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø³Ø¹Ø±" target="_blank">ğŸ’° Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø³Ø¹Ø±</a>
<a href="https://wa.me/201208624618?text=Ø·Ù„Ø¨ Ù„Ù… ÙŠØªÙ…" target="_blank">âŒ Ø·Ù„Ø¨ Ù„Ù… ÙŠØªÙ…</a>
</div>
</div>

<footer>Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Ù…Ø­ÙÙˆØ¸Ø© Â©<br>ØªØ·ÙˆÙŠØ±: mahmoud halhoul<br>ØªØµÙ…ÙŠÙ…: mohamed elskhely</footer>

<script>
let currentDriver='';

// ===== Show Page =====
function showPage(id){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    renderAll();
    renderDriver();
    renderDriversSelect();
}

// ===== Dark Mode =====
function toggleTheme(){
    document.body.classList.toggle('dark');
    const circle=document.querySelector('.toggle-circle');
    circle.textContent=document.body.classList.contains('dark')?'ğŸŒ™':'ğŸŒ';
}

// ===== Ø­ÙØ¸ Ø§Ù„Ø³ÙˆØ§Ù‚ÙŠÙ† =====
function saveDriver(name,phone){
    if(name.trim().split(' ').length<3 || !/^\d{11}$/.test(phone)){
        alert('Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ§Ù‚ ÙŠØ¬Ø¨ Ø§Ù† ÙŠÙƒÙˆÙ† Ø«Ù„Ø§Ø«ÙŠ ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 11 Ø±Ù‚Ù…');
        return false;
    }
    let drivers=JSON.parse(localStorage.drivers||'[]');
    if(!drivers.find(d=>d.phone===phone)){
        drivers.push({name,phone});
        localStorage.drivers=JSON.stringify(drivers);
        renderDriversSelect();
        renderAllDrivers();
    }
    return true;
}

// ===== Render Dropdown Ø§Ù„Ø³ÙˆØ§Ù‚ÙŠÙ† =====
function renderDriversSelect(){
    let select=document.getElementById('selectDriver');
    if(!select) return;
    let drivers=JSON.parse(localStorage.drivers||'[]');
    select.innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ§Ù‚</option>';
    drivers.forEach(d=>{
        select.innerHTML+=`<option value="${d.phone}">${d.name} (${d.phone})</option>`;
    });
}

// ===== Driver Page =====
function enterDriver(){
    let name=driverName.value.trim();
    let phone=driverPhone.value.trim();
    if(!saveDriver(name,phone)) return;
    currentDriver=name;
    renderDriver();
}

// ===== Render Driver Orders =====
function renderDriver(){
    let box=document.getElementById('driverOrders'); box.innerHTML='';
    JSON.parse(localStorage.orders||'[]').forEach(o=>{
        if(o.status!=='done' && (o.driver==='' || o.driver===currentDriver)){
            let driverNameDisplay=o.driver || 'ØºÙŠØ± Ù…Ø³ØªÙ„Ù…';
            box.innerHTML+=`<div class='order'>
            ğŸ‘¤ ${o.name} | Ù†ÙˆØ¹: ${o.type} <br>
            ğŸ“¦ ${o.details}<br>ğŸ’° ${o.price} Ø¬Ù†ÙŠÙ‡ | ğŸ“ ${o.location || 'Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡'}<br>
            Ø§Ù„Ø³ÙˆØ§Ù‚: ${driverNameDisplay}<br>
            Ø§Ù„Ø­Ø§Ù„Ø©: <span class='status-${o.status}'>${o.status}</span><br>
            ${o.driver===''?`<button onclick=takeOrder(${o.id},'${o.phone}','${o.name}','${o.details}','${o.price}','${o.location}')>Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ & ÙˆØ§ØªØ³</button>`:''}
            ${o.driver===currentDriver?`<button onclick=nextStatus(${o.id})>ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©</button>`:''}
            ${o.rating===null?`<button onclick=rateOrder(${o.id})>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø·Ù„Ø¨</button>`:`ØªÙ‚ÙŠÙŠÙ…: ${o.rating} â­`}
            </div>`;
        }
    });
}

// ===== Send Order =====
function sendOrder(){
    let cnameV=cname.value.trim(), cphoneV=cphone.value.trim(), clocationV=clocation.value.trim(), detailsV=details.value.trim();
    let priceV=Number(price.value), typeV=typeClient.value, driverPhoneV=selectDriver.value;
    let valid=true;
    if(cnameV.split(' ').length<3){ cname.style.borderColor='red'; valid=false;} else {cname.style.borderColor='#ccc';}
    if(!/^\d{11}$/.test(cphoneV)){ cphone.style.borderColor='red'; valid=false;} else {cphone.style.borderColor='#ccc';}
    if(priceV<10){ price.style.borderColor='red'; valid=false;} else {price.style.borderColor='#ccc';}
    if(!valid) return;

    let orders=JSON.parse(localStorage.orders||'[]');
    orders.push({
        id:Date.now(), name:cnameV, phone:cphoneV, location:clocationV, details:detailsV,
        price:priceV, type:typeV, status:'new', driver:'', driverPhone:driverPhoneV, rating:null
    });
    localStorage.orders=JSON.stringify(orders);
    alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨');
    cname.value=''; cphone.value=''; clocation.value=''; details.value=''; price.value=''; selectDriver.value='';
    renderDriver();
    renderAll();
}

// ===== Take Order with WhatsApp =====
function takeOrder(id,phone,name,details,price,location){
    let orders=JSON.parse(localStorage.orders||'[]');
    orders=orders.map(o=>o.id===id?{...o,driver:currentDriver,status:'run'}:o);
    localStorage.orders=JSON.stringify(orders);
    renderDriver();
    renderAll();

    let message=`Ù…Ø±Ø­Ø¨Ø§ ${currentDriver}, Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯:
ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}
ğŸ“¦ Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${details}
ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${price} Ø¬Ù†ÙŠÙ‡
ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${location || 'Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡'}`;
    let waLink=`https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
    window.open(waLink,'_blank');
}

// ===== Next Status =====
function nextStatus(id){
    let orders=JSON.parse(localStorage.orders||'[]');
    orders=orders.map(o=>{
        if(o.id===id && o.driver===currentDriver){
            if(o.status==='new') o.status='run';
            else if(o.status==='run') o.status='done';
        } return o;
    });
    localStorage.orders=JSON.stringify(orders);
    renderDriver();
    renderAll();
}

// ===== Rate Order =====
function rateOrder(id){
    let rating=prompt('Ù‚ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† 1 Ø¥Ù„Ù‰ 5 â­');
    rating=Number(rating);
    if(rating>=1 && rating<=5){
        let orders=JSON.parse(localStorage.orders||'[]');
        orders=orders.map(o=>o.id===id?{...o,rating}:o);
        localStorage.orders=JSON.stringify(orders);
        renderDriver();
        renderAll();
    } else alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¨ÙŠÙ† 1 Ùˆ5');
}

// ===== Admin =====
function adminLogin(){
    if(adminPass.value==='mahmoud2008joker679001'){
        adminPanel.style.display='block';
        renderAll();
        renderAllDrivers();
    } else alert('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø·Ø£');
}

function renderAll(){
    let box=document.getElementById('allOrders'); if(!box) return;
    box.innerHTML='';
    JSON.parse(localStorage.orders||'[]').forEach(o=>{
        box.innerHTML+=`<div class='order'>
        ğŸ‘¤ ${o.name} | Ù†ÙˆØ¹: ${o.type} | ${o.details} | ğŸ’° ${o.price} Ø¬Ù†ÙŠÙ‡ | ğŸ“ ${o.location || 'Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡'} | 
        Ø³ÙˆØ§Ù‚: <input value='${o.driver}' onchange="assignDriver(${o.id}, this.value)"> | 
        Ø­Ø§Ù„Ø©: <select onchange="setStatus(${o.id}, this.value)">
            <option value="new" ${o.status==='new'?'selected':''}>new</option>
            <option value="run" ${o.status==='run'?'selected':''}>run</option>
            <option value="done" ${o.status==='done'?'selected':''}>done</option>
        </select>
        ${o.rating!==null?` | ØªÙ‚ÙŠÙŠÙ…: ${o.rating} â­` : ''}
        </div>`;
    });
}

// ===== Assign Driver =====
function assignDriver(id,name){
    let orders=JSON.parse(localStorage.orders||'[]');
    orders=orders.map(o=>o.id===id?{...o,driver:name}:o);
    localStorage.orders=JSON.stringify(orders);
    renderDriver();
}

// ===== Set Status =====
function setStatus(id,status){
    let orders=JSON.parse(localStorage.orders||'[]');
    orders=orders.map(o=>o.id===id?{...o,status}:o);
    localStorage.orders=JSON.stringify(orders);
    renderDriver();
}

// ===== Render Drivers List Admin =====
function renderAllDrivers(){
    let box=document.getElementById('allDrivers'); if(!box) return;
    let drivers=JSON.parse(localStorage.drivers||'[]');
    box.innerHTML='';
    drivers.forEach(d=>{
        box.innerHTML+=`<div class="order">${d.name} | ${d.phone}</div>`;
    });
}

function toggleHelp(){helpOptions.style.display=helpOptions.style.display==='block'?'none':'block'}
</script>
</body>
</html>
